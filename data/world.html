<!DOCTYPE html>
<html>
    <head>
        <link href="style.css" rel="stylesheet">
    </head>
    <body>
        <div id="img_area">
            <canvas id="imgOut" style="image-rendering: pixelated;"></canvas>
        </div>
        <a href="/" id="top">top</a>
    </body>
</html>
<script src="3d.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();


function height(x,y) {
    x+=50
    y+=2
    let base = 0.8;
    let ret = 0;
    let times = 10;
    for (let i=1;i<times;i++) {
        ret += ((Math.cos(x*base/i+i)*Math.cos(y*base/i+i)))*((i**2.8));
        i++;
    }
    return ret/times*0.04-5;
}

let obj = [];
let color = [255,255,255];
for (y=-0;y<80;y+=2) {
    for (x=-0;x<80;x+=2) {
        y_=y;x_=x;
        obj.push([[x_,y_,height(x,y)],[x_,y_-1,height(x,y-1)],[x_+1,y_-1,height(x+1,y-1)],color]);
        obj.push([[x_,y_,height(x,y)],[x_+1,y_-1,height(x+1,y-1)],[x_+1,y_,height(x+1,y)],color]);
        obj.push([[x_,y_,height(x,y)],[x_+1,y_,height(x+1,y)],[x_+1,y_+1,height(x+1,y+1)],color]);
        obj.push([[x_,y_,height(x,y)],[x_+1,y_+1,height(x+1,y+1)],[x_,y_+1,height(x,y+1)],color]);
        obj.push([[x_,y_,height(x,y)],[x_,y_+1,height(x,y+1)],[x_-1,y_+1,height(x-1,y+1)],color]);
        obj.push([[x_,y_,height(x,y)],[x_-1,y_+1,height(x-1,y+1)],[x_-1,y_,height(x-1,y)],color]);
        obj.push([[x_,y_,height(x,y)],[x_-1,y_,height(x-1,y)],[x_-1,y_-1,height(x-1,y-1)],color]);
        obj.push([[x_,y_,height(x,y)],[x_-1,y_-1,height(x-1,y-1)],[x_,y_-1,height(x,y-1)],color]);
    }
}

let tddraw = new tdDRAW();
tddraw.setCamera([[0,0,1],[45,0],[1920,1080]]);
tddraw.setObj(obj);
var co = document.getElementById("imgOut");
var ctx = co.getContext('2d');
co.height=tddraw.display[1];co.width=tddraw.display[0];

let img = tddraw.getImg();
ctx.putImageData(img,0,0);

</script>
<script>
// resize window
function resizeImg() {
        dw = tddraw.display[0];
        dh = tddraw.display[1];
        let bottom_area = 0;
        let rw = 0;let rh = 0;
        let ww = window.innerWidth;
        let wh = window.innerHeight-bottom_area;
        let csc = 1
        hcsc = ww/dw; wcsc = wh/dh;
        if (hcsc>wcsc) {
            csc = wcsc; rw = (ww - dw*csc)/2;
        }
        else {
            csc = hcsc; rh = (wh - dh*csc)/2;
        }
        document.getElementById("imgOut").style.marginTop = (rh).toString()+"px";
        document.getElementById("imgOut").style.marginBottom = (rh).toString()+"px";
        document.getElementById("imgOut").style.marginLeft = (rw).toString()+"px";
        document.getElementById("imgOut").style.marginRight = (rw).toString()+"px";
        document.getElementById("imgOut").style.transform = "scale("+csc.toString()+","+csc.toString()+")";
    };
window.onresize = resizeImg;
resizeImg(); // first resize
</script>
<style>
    body {
        overflow: hidden;
    }
    #top {
        position: absolute;
        bottom: 0;
        left: 0;
    }
    #imgOut {
        position: absolute;
        left: 0;
        top: 0;
        transform-origin: top left;
    }
</style>