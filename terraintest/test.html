<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    </head>
    <body>
        <canvas id="imgOut"></canvas>
    </body>
</html>
<script>
    function mkimg(x,y) {
        let iarr = new Uint8ClampedArray(x*y*4);
        for (let iy = 0; iy < y; iy++) {
            for (let ix = 0; ix < x; ix++) {
                let index = (iy*x+ix)*4; // index of position [ix,iy]
                let value = getp([ix,iy])
                //value = _getp([0,0,100],[0,1,0],[1,1,100],[1,0,250],[ix/10,iy/10])
                //value = _getp([0,0,100],[0,2,0],[2,2,100],[2,0,250],[ix/10,iy/10])
                iarr[index+0] = value; // Red
                iarr[index+1] = value; // Green
                iarr[index+2] = value; // Blue
                iarr[index+3] = 250; // Alpha
            }
        }
        let co = document.getElementById("imgOut");
        co.height=y;co.width=x;co.getContext('2d').putImageData(new ImageData(iarr,x,y),0,0);
    }
    mkimg(1000,1000)

function _getp(a,b,c,d,p) {
    let a1 = (p[0]-a[0])*(p[1]-a[1]);
    let a2 = (p[0]-b[0])*(b[1]-p[1]);
    let a3 = (c[0]-p[0])*(c[1]-p[1]);
    let a4 = (d[0]-p[0])*(p[1]-d[1]);
    //console.log(a1,a2,a3,a4)
   // console.log(p)
    return (a[2]*a1+b[2]*a2+c[2]*a3+d[2]*a4);
}
function getp(p) {
    let s = 6;
    let minx = Math.floor(p[0]/(2**s))*(2**s);
    let maxx = minx+(2**s);
    let miny = Math.floor(p[1]/(2**s))*(2**s);
    let maxy = miny+(2**s);
   // console.log(minx,maxx,miny,maxy)
    let res = _getp([0,0,test8(minx,miny)],[0,1,test8(minx,maxy)],[1,1,test8(maxx,maxy)],[1,0,test8(maxx,miny)],[(p[0]-minx)/2**s,(p[1]-miny)/2**s]);
    res = _getp([0,0,test8(maxx,miny)],[0,1,test8(maxx,maxy)],[1,1,test8(minx,maxy)],[1,0,test8(minx,miny)],[(p[0]-minx)/2**s,(p[1]-miny)/2**s]);
    res = _getp([0,0,test8(maxx,maxy)],[0,1,test8(maxx,miny)],[1,1,test8(minx,miny)],[1,0,test8(minx,maxy)],[(p[0]-minx)/2**s,(p[1]-miny)/2**s]);
    //console.log(res)
    return res;
}
let a = _getp([0,0,10],[0,1,5],[1,1,9],[1,0,6],[0.5,0.5]);
console.log(a)





function test8(x,y) {
    let base = 500;
    let ret = 0;
    let times = 3;
    for (let i=1;i<=times;i++) {
        ret += ((Math.cos(x*base/i+i)*Math.cos(y*base/i+i)))*((i**7));
        i++;
    }
    return Math.abs(ret/times*4+128)%1*255;
}

</script>
<style>
    #imgOut {
        height: 80vh;
        image-rendering: pixelated;
    }
</style>